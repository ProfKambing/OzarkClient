package me.trambled.ozark.ozarkclient.module.exploit;

import me.trambled.ozark.ozarkclient.module.Category;
import me.trambled.ozark.ozarkclient.module.Module;
import me.trambled.ozark.ozarkclient.module.Setting;
import me.trambled.ozark.ozarkclient.util.player.PlayerUtil;
import net.minecraft.init.Items;
import net.minecraft.item.ItemFood;
import net.minecraft.item.ItemStack;
import net.minecraft.util.EnumHand;

public class AutoEat extends Module {

    public AutoEat() {
        super(Category.EXPLOIT);

        this.name        = "AutoEat";
        this.tag         = "AutoEat";
        this.description = "Eats automatically.";
    }

    Setting health = create("Health", "Health", 15f, 0f, 36f);
    Setting hunger = create("Hunger", "Hunger", 15f, 0f, 20f);

    private boolean m_WasEating = false;

    @Override
    protected void disable()
    {
        if (m_WasEating)
        {
            m_WasEating = false;
            mc.gameSettings.keyBindUseItem.pressed = false;
        }
    }


    @Override
    public void update() {
        float l_Health = mc.player.getHealth() + mc.player.getAbsorptionAmount();

        if (health.get_value(1) >= l_Health && !PlayerUtil.IsEating())
        {
            if (mc.player.getHeldItemMainhand().getItem() != Items.GOLDEN_APPLE)
            {
                for (int l_I = 0; l_I < 9; ++l_I)
                {
                    if (mc.player.inventory.getStackInSlot(l_I).isEmpty() || mc.player.inventory.getStackInSlot(l_I).getItem() != Items.GOLDEN_APPLE)
                        continue;

                    mc.player.inventory.currentItem = l_I;
                    mc.playerController.updateController();
                    break;
                }

                if (mc.currentScreen == null)
                    mc.gameSettings.keyBindUseItem.pressed = true;
                else
                    mc.playerController.processRightClick(mc.player, mc.world, EnumHand.MAIN_HAND);

                m_WasEating = true;
            }
            return;
        }

        if (!PlayerUtil.IsEating() && hunger.get_value(1) >= mc.player.getFoodStats().getFoodLevel())
        {
            boolean l_CanEat = false;

            for (int l_I = 0; l_I < 9; ++l_I)
            {
                ItemStack l_Stack = mc.player.inventory.getStackInSlot(l_I);

                if (mc.player.inventory.getStackInSlot(l_I).isEmpty())
                    continue;

                if (l_Stack.getItem() instanceof ItemFood)
                {
                    l_CanEat = true;
                    mc.player.inventory.currentItem = l_I;
                    mc.playerController.updateController();
                    break;
                }
            }

            if (l_CanEat)
            {
                if (mc.currentScreen == null)
                    mc.gameSettings.keyBindUseItem.pressed = true;
                else
                    mc.playerController.processRightClick(mc.player, mc.world, EnumHand.MAIN_HAND);

                m_WasEating = true;
            }
        }

        if (m_WasEating)
        {
            m_WasEating = false;
            mc.gameSettings.keyBindUseItem.pressed = false;
        }
    }
}
